{% extends "base2.html" %}
{% load static %}
{% block title %}Detection Result{% endblock title %}
{% block content %}

        <style>
            body{
                background-color: #f6f6fa;
            }
            /* Card hover effect */
            .center-content {
                display: flex;
                flex-direction: column;
                align-items: center; /* Centers elements horizontally */
                justify-content: center; /* Centers elements vertically */
                text-align: center; /* Ensures text is centered */
                height: 100%; /* Ensures the div takes full height */
            }
            .divider {
                width: 50%;
                height: 2px;
                background-color: #f74780;
                margin: 20px auto; /* Centers the divider */
            }
            .card {
                transition: transform 0.3s, box-shadow 0.3s;
                border-radius: 15px;
                border: 2px solid lightgray;
            }
        
            .card:hover {
                transform: translateY(-5px);
                box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
            }
            .download-icon {
                position: absolute;
                top: 10px;
                right: 30px;
                background-color: rgba(255, 255, 255, 0.4);
                padding: 4px;
                border-radius: 50%;
                z-index: 10;
                transition: transform 0.2s;
            }
        
            .download-icon:hover {
                transform: scale(1.1);
            }
            /* Image styling */
            .img-fluid {
                border-radius: 10px;
                object-fit: cover;
            }
        
            h6 {
                font-size: 1.1rem;
                line-height: 1.2;
            }
        
            /* Model card styling */
            .model-card {
                border-left: 3px solid #f74780;
                background-color: white;
                border-radius: 10px;
                padding: 20px;
                min-width: 250px;
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                margin: 10px;
            }
        
            /* Text styling */
            .model-card h5,
            .model-card p {
                font-size: 22px;
                margin: 5px 0;
            }
        
            .model-btn {
                border: 2px solid #ddd;
                padding: 8px 20px;
                border-radius: 10px;
                background-color: #f74780;
                transition: all 0.3s ease;
                font-weight: 500;
                color: white;
                outline: none;
            }
            
            .model-btn:hover {
                background-color: #;
                color: white;
                border-color: #f74900;
                transform: translateY(-3px);
                box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            }
            
            .model-btn:active {
                transform: translateY(2px);
                box-shadow: none;
            }
            .img-container {
                flex: 1; /* Makes both images take equal space */
                max-width: 45%; /* Prevents images from being too large */
                min-width: 250px; /* Ensures they donâ€™t get too small */
                border: 2px solid lightcoral;
                border-radius: 10px;
                margin: 0 20px;
                box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
                padding: 10px; /* Adds spacing around images */
            }
        
            .img-container img {
                width: 90%; /* Makes images fill their container */
                height: auto; /* Maintains aspect ratio */
                display: block; /* Prevents extra space below images */
            }
        
            /* Adjust layout for smaller screens */
            @media (max-width: 768px) {
                .d-flex {
                    flex-direction: column; /* Stack images vertically */
                }
                .img-container {
                    max-width: 80%; /* Increase size for small screens */
                    text-align: center; /* Center align images */
                }
            }
        </style>

        <div class="container-fluid bg-breadcrumb" style="background-color: white;">
            <ul class="breadcrumb-animation">
                <li></li>
                <li></li>
                <li></li>
                <li></li>
                <li></li>
                <li></li>
                <li></li>
                <li></li>
                <li></li>
                <li></li>
            </ul>
            <div class="container text-center py-5" style="max-width: 900px;">
                <h3 class="display-3 mb-4 wow fadeInDown" data-wow-delay="0.1s">Detection Result</h1>
                <ol class="breadcrumb justify-content-center mb-0 wow fadeInDown" data-wow-delay="0.3s">
                    <li class="breadcrumb-item"><a href="{% url 'user_dashboard' %}">User</a></li>
                    <li class="breadcrumb-item active text-primary">Detection Result</li>
                </ol>     
            </div>
        </div>
        <div >
            <h1 class="text-center" style="font-family:'Rubik',sans-serif;">RESULT</h1>
            <div class="divider"></div>
            <div class="container">
                <div class="d-flex flex-column justify-content-center align-items-center">
                    <div class=" d-flex flex-column align-items-center" style="position: relative; display: inline-block;">
                        <a href="{{ image_url }}" download class="download-icon" title="Download Image">
                            <i class="fa fa-solid fa-download" style="font-size: 25px;color: black;"></i>
                        </a>
                        <img src="{{image_url}}" alt="result image" style="max-width: 100%; height: 550px;border: 4px solid #f74780;border-radius: 4px;">

                        <a href="detection">
                            <button type="button" class="model-btn mx-2 mt-4">
                                Detect again
                            </button>
                        </a>
                    </div>
                </div>
                <div class="divider"></div>
                <h3 class="text-center pb-4">Model Details</h3>
            <div class="container justify-content-center align-items-center my-4 p-4" >
                <div class="row g-4 mx-4 align-items-start justify-content-between">
                    <div class="col-md-8" style="width: 100%; max-width: 600px; height: 450px;">
                        <canvas id="accuracyChart" style="width: 100%; height: 100%;"></canvas>
                    </div>
                
                    <div class="col-lg-4 d-flex flex-column gap-3">
                        <div class="model-card shadow text-center p-4 w-100">
                            <h5 class="fw-bold mb-2">Model:</h5>
                            <p class="mb-0">YOLO v10</p>
                        </div>
                
                        <div class="model-card shadow text-center p-4 w-100">
                            <h5 class="fw-bold mb-2">Model Accuracy:</h5>
                            <p class="mb-0">{{ model_accuracy }}%</p>
                        </div>
                
                        <div class="model-card shadow text-center p-4 w-100">
                            <h5 class="fw-bold mb-2">Output:</h5>
                            {% for label, count in class_counts.items %}
                                <li><strong>{{ label }}</strong>: {{ count }}</li>
                            {% endfor %}
                        </div>
                    </div>
                </div>                
            </div>
                    
            </div>
            <div class="divider"></div>
            <div class="d-flex text-center justify-content-around align-items-center">
                    <div>
                        <p style="text-align: center; font-size: 18px; color: #333; max-width: 600px; margin: 20px auto;">
                            Our system utilizes the <strong>YOLO v10</strong> (You Only Look Once) deep learning model, optimized for real-time object detection. 
                            This model processes blood sample images in a single pass, accurately identifying and counting both <strong>Red Blood Cells (RBCs)</strong> 
                            and <strong>White Blood Cells (WBCs)</strong>. With its enhanced speed and precision, YOLO v10 ensures efficient and reliable 
                            blood cell detection, making it suitable for medical diagnostic support.
                        </p>
                    </div>
                    <div>
                        <p class="mt-4" style="font-size: 22px;">
                            Total Number of detected blood cells are:<h4 style="font-weight: bold;">{{count}}</h4>
                        </p>
                        <img src="{% static 'user/img/blood-about.png' %}" alt="" style="height: 300px;">
                    </div>
                    
                    
                </div> 
        </div>
        <div class="divider"></div>
        <div class="p-4">
            <h3 class="text-center pb-4">Visualization Graphs</h3>
            <div class="d-flex flex-wrap justify-content-center align-items-center">
                <div class="img-container">
                    <img src="{% static 'user/img/o1.png' %}" alt="">
                </div>
                <div class="img-container">
                    <img src="{% static 'user/img/o2.png' %}" alt="">
                </div>
                <div class="img-container">
                    <img src="{% static 'user/img/o3.png' %}" alt="">
                </div>
            </div>
        </div>

        <div class="text-center" style="margin-top: 30px; margin-bottom: 50px;">
            <a href="{% url 'download_report' %}" class="btn btn-primary btn-lg" style="background-color: #d32f2f; border-color: #d32f2f; color: white; padding: 12px 30px; border-radius: 50px; font-weight: bold; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                <i class="fa fa-download"></i> Download Medical Report (PDF)
            </a>
        </div>
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
            <script>
            document.addEventListener('DOMContentLoaded', function() {
                const ctx = document.getElementById('accuracyChart').getContext('2d');
                const accuracy = "{{model_accuracy}}" ;
                const label = "{{model_label}}";

                const accuracyChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: [0, 100],  // Adding min and max values to x-axis
                        datasets: [{
                            label: label,
                            data: [{ x: 0, y: 0 }, { x: accuracy, y: accuracy }],
                            borderColor: 'Red',
                            backgroundColor: 'Red',
                            borderWidth: 2,
                            fill: false,
                            tension: 0.1,
                            pointRadius: 5,
                            pointBackgroundColor: '#f74780',
                            pointBorderColor: '#f74780',
                            pointHoverRadius: 7,
                            pointHoverBackgroundColor: '#f74780',
                            pointHoverBorderColor: '#f74780',
                            showLine: true  // Ensures the line is drawn
                        }]
                    },
                    options: {
                        scales: {
                            x: {
                                type: 'linear',
                                title: {
                                    display: true,
                                    text: 'Accuracy (%)'
                                },
                                min: 0,
                                max: 100,
                                ticks: {
                                    stepSize: 10,
                                    callback: function(value) { return value; },
                                    beginAtZero: true
                                }
                            },
                            y: {
                                title: {
                                    display: true,
                                    text: 'Accuracy (%)'
                                },
                                min: 0,
                                max: 100,
                                ticks: {
                                    stepSize: 10,
                                    beginAtZero: true
                                }
                            }
                        },
                        plugins: {
                            legend: {
                                display: false
                            },
                            tooltip: {
                                callbacks: {
                                    title: function() {
                                        return '';
                                    },
                                    label: function(tooltipItem) {
                                        return tooltipItem.dataset.label + ': ' + tooltipItem.raw.y + '%';
                                    }
                                }
                            }
                        }
                    }
                });
            });
        </script>

        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

{% endblock content%}